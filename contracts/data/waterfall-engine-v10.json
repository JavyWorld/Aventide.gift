{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aventide.gift/contracts/data/waterfall-engine-v10.entity.v2.json",
  "title": "waterfall Critical Entity",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "id",
    "domain",
    "majorVersion",
    "status",
    "amount",
    "currency",
    "createdAt",
    "updatedAt",
    "compatibility"
  ],
  "properties": {
    "id": { "type": "string", "format": "uuid" },
    "domain": { "type": "string", "const": "waterfall-engine-v10" },
    "majorVersion": { "type": "integer", "const": 2 },
    "status": { "type": "string", "enum": ["created", "authorized", "captured", "released", "disputed", "settled"] },
    "amount": { "type": "integer", "minimum": 0 },
    "currency": { "type": "string", "enum": ["COP", "USD", "EUR"] },
    "createdAt": { "type": "string", "format": "date-time" },
    "updatedAt": { "type": "string", "format": "date-time" },
    "metadata": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "externalRef": { "type": "string" },
        "countryCode": { "type": "string", "minLength": 2, "maxLength": 2 }
      }
    },
    "compatibility": {
      "type": "object",
      "additionalProperties": false,
      "required": ["currentMajor", "readableMajors", "breakingChangesFrom"],
      "properties": {
        "currentMajor": { "type": "integer", "const": 2 },
        "readableMajors": {
          "type": "array",
          "items": { "type": "integer", "minimum": 1 },
          "minItems": 1,
          "uniqueItems": true
        },
        "breakingChangesFrom": {
          "type": "array",
          "items": { "type": "integer", "minimum": 1 },
          "description": "Versiones mayores que requieren migración explícita."
        }
      }
    }
  }
}
